<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashback - –ù–æ—Å—Ç–∞–ª—å–≥–∏—è –≤ –∂–µ—Å—Ç–∞—Ö</title>
    <meta name="theme-color" content="#8B0000">
    <link rel="manifest" href="manifest.json">
    <style>
        /* –í–°–ï –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –ü–†–ï–ñ–ù–ò–ú–ò - –Ω–µ –º–µ–Ω—è–µ–º */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        body { 
            background: #000; 
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            overflow: hidden;
            touch-action: pan-y;
            transition: all 0.3s ease;
        }
        
        /* ... –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –¢–ê–ö–ò–ï –ñ–ï –ö–ê–ö –†–ê–ù–¨–®–ï ... */
        
    </style>
</head>
<body class="dark-theme">
    <div class="app">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="status-bar" id="statusBar">
            üì∏ Flashback ‚Ä¢ <span id="photoCounter">1</span>/<span id="totalPhotos">0</span>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content" id="mainContent">
            <!-- –≠–ö–†–ê–ù –ü–†–û–°–ú–û–¢–†–ê –§–û–¢–û -->
            <div class="screen active" id="homeScreen">
                <div class="photo-screen">
                    <div class="photo-viewport" id="photoViewport">
                        <div class="photo-slide current" id="currentSlide">
                            <div class="photo-content">
                                <div id="photoTitle">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ...</div>
                                <div class="photo-subtitle" id="photoSubtitle">–ü–æ—Ç—è–Ω–∏—Ç–µ —Ñ–æ—Ç–æ –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏</div>
                            </div>
                            <div class="photo-info" id="photoInfo">
                                üìÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...
                            </div>
                        </div>
                    </div>
                    
                    <div class="gesture-overlay" id="gestureOverlay">
                        <div class="gesture-hint hint-next"></div>
                        <div class="gesture-hint hint-prev"></div>
                        <div class="gesture-hint hint-info"></div>
                        <div class="gesture-hint hint-like"></div>
                    </div>
                    
                    <div class="like-animation" id="likeAnimation">‚ù§Ô∏è</div>
                    <div class="double-tap-hint" id="doubleTapHint">–î–≤–æ–π–Ω–æ–π —Ç–∞–ø –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ ‚ù§Ô∏è</div>
                </div>
            </div>
            
            <!-- –ù–û–í–´–ô –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò –§–û–¢–û -->
            <div class="screen" id="uploadScreen">
                <div class="settings-screen">
                    <div class="settings-header">
                        <h2>üì∏ –í–∞—à–∏ —Ñ–æ—Ç–æ</h2>
                        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏</p>
                    </div>
                    <div class="settings-list">
                        <div class="settings-section">
                            <div class="settings-section-title">üìÅ –ò—Å—Ç–æ—á–Ω–∏–∫ —Ñ–æ—Ç–æ</div>
                            <button class="action-btn" onclick="loadFromGallery()">
                                üì± –í—ã–±—Ä–∞—Ç—å –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
                            </button>
                            <button class="action-btn" onclick="takePhoto()">
                                üì∑ –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
                            </button>
                            <button class="action-btn" onclick="useDemoPhotos()">
                                üé≠ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ-—Ñ–æ—Ç–æ
                            </button>
                        </div>
                        
                        <div class="settings-section">
                            <div class="settings-section-title">üìä –°—Ç–∞—Ç—É—Å</div>
                            <div style="padding: 15px; text-align: center;">
                                <p id="photoStatus">–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>
                                <p>–ó–∞–≥—Ä—É–∂–µ–Ω–æ: <span id="loadedCount">0</span> —Ñ–æ—Ç–æ</p>
                                <p>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º: <span id="favoritesCount">0</span></p>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <div class="settings-section-title">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                            <button class="action-btn" onclick="clearAllPhotos()">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ
                            </button>
                            <button class="action-btn" onclick="showScreen('homeScreen')">
                                üì∏ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –≠–ö–†–ê–ù –ü–û–ò–°–ö–ê -->
            <div class="screen" id="searchScreen">
                <div class="search-screen">
                    <div class="search-header">
                        <h2>üîç –ü–æ–∏—Å–∫</h2>
                        <p>–ù–∞–π–¥–∏—Ç–µ —Ñ–æ—Ç–æ –ø–æ —Ç–µ–≥–∞–º –∏ –¥–∞—Ç–∞–º</p>
                    </div>
                    
                    <input type="text" class="search-input" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –∏–ª–∏ –¥–∞—Ç—É...">
                    
                    <div class="search-tags" id="searchTags">
                        <div class="search-tag active" onclick="filterByTag('–≤—Å–µ')">–í—Å–µ</div>
                        <div class="search-tag" onclick="filterByTag('–∏–∑–±—Ä–∞–Ω–Ω–æ–µ')">‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
                        <div class="search-tag" onclick="filterByTag('–Ω–µ–¥–∞–≤–Ω–∏–µ')">üïí –ù–µ–¥–∞–≤–Ω–∏–µ</div>
                    </div>
                    
                    <div class="search-results" id="searchResults">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
            
            <!-- –≠–ö–†–ê–ù –ò–ó–ë–†–ê–ù–ù–û–ì–û -->
            <div class="screen" id="favoritesScreen">
                <div class="favorites-screen">
                    <div class="favorites-header">
                        <h2>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
                        <p>–õ–∞–π–∫–Ω—É—Ç—ã–µ —Ñ–æ—Ç–æ</p>
                    </div>
                    <div class="favorites-grid" id="favoritesGrid">
                        <!-- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
            
            <!-- –≠–ö–†–ê–ù –ù–ê–°–¢–†–û–ï–ö -->
            <div class="screen" id="settingsScreen">
                <div class="settings-screen">
                    <div class="settings-header">
                        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                        <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</p>
                    </div>
                    <div class="settings-list">
                        <!-- –ù–ê–°–¢–†–û–ô–ö–ò –§–û–¢–û -->
                        <div class="settings-section">
                            <div class="settings-section-title">üì∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ</div>
                            <button class="action-btn" onclick="showScreen('uploadScreen')">
                                üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
                            </button>
                            <button class="action-btn" onclick="exportAllData()">
                                üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                            </button>
                        </div>
                        
                        <!-- –ù–ê–°–¢–†–û–ô–ö–ò –í–ù–ï–®–ù–ï–ì–û –í–ò–î–ê -->
                        <div class="settings-section">
                            <div class="settings-section-title">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <div class="setting-title">üéÆ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∂–µ—Å—Ç–æ–≤</div>
                                    <div class="setting-description">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div>
                                </div>
                                <button class="toggle-btn" id="hintsToggle" onclick="toggleHints()">–í–ö–õ</button>
                            </div>
                            
                            <div class="settings-item">
                                <div class="setting-info">
                                    <div class="setting-title">üåà –¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</div>
                                    <div class="setting-description">–¢—ë–º–Ω–∞—è –∏–ª–∏ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</div>
                                </div>
                                <button class="toggle-btn" id="themeToggle" onclick="toggleTheme()">–¢–Å–ú–ù–ê–Ø</button>
                            </div>
                        </div>
                        
                        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
                        <div class="settings-section">
                            <div class="settings-section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div style="padding: 15px;">
                                <p>üì∏ –í—Å–µ–≥–æ —Ñ–æ—Ç–æ: <span id="statsTotal">0</span></p>
                                <p>‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º: <span id="statsLiked">0</span></p>
                                <p>üïí –í—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: <span id="statsTime">0</span> –º–∏–Ω</p>
                            </div>
                        </div>
                        
                        <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò -->
                        <div class="settings-section">
                            <div class="settings-section-title">üíæ –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                            <button class="action-btn" onclick="clearData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                            <button class="action-btn" onclick="resetTutorial()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
        <div class="bottom-tabs" id="bottomTabs">
            <div class="tab-highlight" id="tabHighlight"></div>
            <button class="tab active" onclick="showScreen('homeScreen')">
                <div class="tab-icon">üì∏</div>
                <div>–ì–ª–∞–≤–Ω–∞—è</div>
            </button>
            <button class="tab" onclick="showScreen('uploadScreen')">
                <div class="tab-icon">üìÅ</div>
                <div>–§–æ—Ç–æ</div>
            </button>
            <button class="tab" onclick="showScreen('searchScreen')">
                <div class="tab-icon">üîç</div>
                <div>–ü–æ–∏—Å–∫</div>
            </button>
            <button class="tab" onclick="showScreen('favoritesScreen')">
                <div class="tab-icon">‚ù§Ô∏è</div>
                <div>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
            </button>
            <button class="tab" onclick="showScreen('settingsScreen')">
                <div class="tab-icon">‚öôÔ∏è</div>
                <div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </button>
        </div>
        
        <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤ -->
        <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
        <input type="file" id="cameraInput" accept="image/*" capture="camera" style="display: none;">
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let userPhotos = [];
        let currentPhotoIndex = 0;
        let appData = {
            viewed: 0,
            liked: [],
            showHints: true,
            darkTheme: true,
            startTime: Date.now(),
            tutorialCompleted: false,
            tutorialShown: false
        };
        
        let lastTap = 0;
        let infoVisible = false;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let currentSearchTag = '–≤—Å–µ';
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let tutorialTimer = null;

        // –î–µ–º–æ-—Ñ–æ—Ç–æ –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –≥–∞–ª–µ—Ä–µ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
        const demoPhotos = [
            { 
                id: 'demo1', 
                title: "–ì–æ—Ä–Ω—ã–π –ø–µ–π–∑–∞–∂", 
                liked: false,
                date: new Date().toLocaleDateString('ru-RU'),
                location: "–ì–æ—Ä—ã",
                camera: "–î–µ–º–æ-—Ñ–æ—Ç–æ",
                tags: ["–ø—Ä–∏—Ä–æ–¥–∞", "–≥–æ—Ä—ã"],
                isDemo: true
            },
            { 
                id: 'demo2', 
                title: "–ì–æ—Ä–æ–¥—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", 
                liked: false,
                date: new Date().toLocaleDateString('ru-RU'),
                location: "–ì–æ—Ä–æ–¥",
                camera: "–î–µ–º–æ-—Ñ–æ—Ç–æ", 
                tags: ["–≥–æ—Ä–æ–¥", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"],
                isDemo: true
            },
            { 
                id: 'demo3', 
                title: "–ú–æ—Ä—Å–∫–æ–π –±–µ—Ä–µ–≥", 
                liked: false,
                date: new Date().toLocaleDateString('ru-RU'),
                location: "–ü–ª—è–∂",
                camera: "–î–µ–º–æ-—Ñ–æ—Ç–æ",
                tags: ["–º–æ—Ä–µ", "–ø–ª—è–∂"],
                isDemo: true
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadData();
            setupEventListeners();
            updateDisplay();
            setupGestures();
            setupDragAndDrop();
            setupSmoothMenu();
            updateSettingsButtons();
            applyTheme();
            updateSearchResults();
            updateTabHighlight();
            startTutorialTimer();
            updatePhotoStatus();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
            const saved = localStorage.getItem('flashbackApp');
            if (saved) {
                const loaded = JSON.parse(saved);
                appData = { ...appData, ...loaded };
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–æ—Ç–æ
                const savedPhotos = localStorage.getItem('flashbackPhotos');
                if (savedPhotos) {
                    userPhotos = JSON.parse(savedPhotos);
                }
                
                if (appData.tutorialShown) {
                    hideTutorialText();
                }
            }
            appData.startTime = Date.now();
            
            // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ç–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ
            if (userPhotos.length === 0) {
                userPhotos = [...demoPhotos];
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            const timeUsed = Math.floor((Date.now() - appData.startTime) / 60000);
            appData.usageTime = timeUsed;
            
            localStorage.setItem('flashbackApp', JSON.stringify(appData));
            localStorage.setItem('flashbackPhotos', JSON.stringify(userPhotos));
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const cameraInput = document.getElementById('cameraInput');
            
            fileInput.addEventListener('change', handleFileSelect);
            cameraInput.addEventListener('change', handleFileSelect);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
        function loadFromGallery() {
            document.getElementById('fileInput').click();
        }
        
        // –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
        function takePhoto() {
            document.getElementById('cameraInput').click();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const newPhoto = {
                            id: 'user_' + Date.now() + '_' + i,
                            title: file.name.replace(/\.[^/.]+$/, ""), // —É–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
                            liked: false,
                            date: new Date(file.lastModified).toLocaleDateString('ru-RU'),
                            location: "–ì–∞–ª–µ—Ä–µ—è",
                            camera: "–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",
                            tags: ["–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ"],
                            url: e.target.result,
                            isDemo: false
                        };
                        
                        userPhotos.push(newPhoto);
                        saveData();
                        updatePhotoStatus();
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä
                        if (userPhotos.length === 1) {
                            currentPhotoIndex = 0;
                            showScreen('homeScreen');
                            updateDisplay();
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            }
        }
        
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ-—Ñ–æ—Ç–æ
        function useDemoPhotos() {
            userPhotos = [...demoPhotos];
            currentPhotoIndex = 0;
            saveData();
            updatePhotoStatus();
            showScreen('homeScreen');
            updateDisplay();
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ
        function clearAllPhotos() {
            if (confirm('‚ùå –£–¥–∞–ª–∏—Ç—å –í–°–ï —Ñ–æ—Ç–æ?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                userPhotos = [...demoPhotos];
                currentPhotoIndex = 0;
                appData.liked = [];
                saveData();
                updatePhotoStatus();
                updateDisplay();
                alert('‚úÖ –í—Å–µ —Ñ–æ—Ç–æ –æ—á–∏—â–µ–Ω—ã!');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ñ–æ—Ç–æ
        function updatePhotoStatus() {
            const status = document.getElementById('photoStatus');
            const loadedCount = document.getElementById('loadedCount');
            const favoritesCount = document.getElementById('favoritesCount');
            const userPhotoCount = userPhotos.filter(photo => !photo.isDemo).length;
            
            loadedCount.textContent = userPhotoCount;
            favoritesCount.textContent = appData.liked.length;
            
            if (userPhotoCount === 0) {
                status.textContent = '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-—Ñ–æ—Ç–æ';
            } else {
                status.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${userPhotoCount} —Ñ–æ—Ç–æ`;
            }
        }
        
        // –¢–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏
        function startTutorialTimer() {
            if (tutorialTimer) clearTimeout(tutorialTimer);
            
            tutorialTimer = setTimeout(() => {
                if (appData.viewed >= 3 && !appData.tutorialShown) {
                    hideTutorialText();
                    appData.tutorialShown = true;
                    saveData();
                }
            }, 60000);
        }
        
        function hideTutorialText() {
            const subtitle = document.getElementById('photoSubtitle');
            subtitle.classList.add('hidden');
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
        function applyTheme() {
            if (appData.darkTheme) {
                document.body.className = 'dark-theme';
            } else {
                document.body.className = 'light-theme';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateDisplay() {
            if (userPhotos.length === 0) {
                document.getElementById('photoTitle').textContent = '–ù–µ—Ç —Ñ–æ—Ç–æ';
                document.getElementById('photoSubtitle').textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏';
                document.getElementById('photoInfo').innerHTML = 'üìÖ –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
                document.getElementById('photoCounter').textContent = '0';
                document.getElementById('totalPhotos').textContent = '0';
                return;
            }
            
            const photo = userPhotos[currentPhotoIndex];
            const slide = document.getElementById('currentSlide');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–æ—Ç–æ
            if (photo.url) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ñ–æ—Ç–æ
                slide.style.background = `url(${photo.url}) center/cover`;
                document.getElementById('photoTitle').textContent = photo.title;
            } else {
                // –î–µ–º–æ-—Ñ–æ—Ç–æ
                slide.style.background = 'linear-gradient(135deg, #8B0000, #600000)';
                document.getElementById('photoTitle').textContent = photo.title;
            }
            
            document.getElementById('photoCounter').textContent = currentPhotoIndex + 1;
            document.getElementById('totalPhotos').textContent = userPhotos.length;
            
            document.getElementById('photoInfo').innerHTML = 
                `üìÖ ${photo.date} ‚Ä¢ üìç ${photo.location}<br>‚öôÔ∏è ${photo.camera}`;
            
            document.getElementById('statsTotal').textContent = userPhotos.length;
            document.getElementById('statsLiked').textContent = appData.liked.length;
            document.getElementById('statsTime').textContent = Math.floor((Date.now() - appData.startTime) / 60000);
            
            updateFavorites();
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç–∞–∫–∏–º–∏ –∂–µ, –Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å userPhotos
        function nextPhoto() {
            if (userPhotos.length === 0) return;
            
            const currentSlide = document.getElementById('currentSlide');
            
            currentSlide.classList.remove('current');
            currentSlide.classList.add('leaving-next');
            
            setTimeout(() => {
                currentPhotoIndex = (currentPhotoIndex + 1) % userPhotos.length;
                appData.viewed++;
                
                currentSlide.classList.remove('leaving-next');
                currentSlide.classList.add('entering-next');
                
                updateDisplay();
                saveData();
                
                setTimeout(() => {
                    currentSlide.classList.remove('entering-next');
                    currentSlide.classList.add('current');
                }, 500);
                
            }, 500);
        }
        
        function previousPhoto() {
            if (userPhotos.length === 0) return;
            
            const currentSlide = document.getElementById('currentSlide');
            
            currentSlide.classList.remove('current');
            currentSlide.classList.add('leaving-prev');
            
            setTimeout(() => {
                currentPhotoIndex = (currentPhotoIndex - 1 + userPhotos.length) % userPhotos.length;
                appData.viewed++;
                
                currentSlide.classList.remove('leaving-prev');
                currentSlide.classList.add('entering-prev');
                
                updateDisplay();
                saveData();
                
                setTimeout(() => {
                    currentSlide.classList.remove('entering-prev');
                    currentSlide.classList.add('current');
                }, 500);
                
            }, 500);
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Drag and Drop, –º–µ–Ω—é, –∂–µ—Å—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ
        // ... (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏)
        
        // –î–≤–æ–π–Ω–æ–π —Ç–∞–ø –¥–ª—è –ª–∞–π–∫–∞
        function toggleLike() {
            if (userPhotos.length === 0) return;
            
            const photo = userPhotos[currentPhotoIndex];
            photo.liked = !photo.liked;
            
            if (photo.liked) {
                if (!appData.liked.includes(photo.id)) {
                    appData.liked.push(photo.id);
                }
                const heart = document.getElementById('likeAnimation');
                heart.classList.add('show');
                setTimeout(() => {
                    heart.classList.remove('show');
                }, 600);
            } else {
                appData.liked = appData.liked.filter(id => id !== photo.id);
            }
            
            updateDisplay();
            saveData();
            updatePhotoStatus();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        function updateFavorites() {
            const grid = document.getElementById('favoritesGrid');
            const likedPhotos = userPhotos.filter(photo => photo.liked);
            
            if (likedPhotos.length === 0) {
                grid.innerHTML = '<div class="empty-favorites">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ<br><small>–î–≤–æ–π–Ω–æ–π —Ç–∞–ø —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å ‚ù§Ô∏è</small></div>';
            } else {
                grid.innerHTML = likedPhotos.map(photo => `
                    <div class="favorite-item" onclick="openFavorite('${photo.id}')">
                        ${photo.title}<br>
                        <small style="font-size: 24px;">‚ù§Ô∏è</small>
                    </div>
                `).join('');
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ
        function openFavorite(photoId) {
            const index = userPhotos.findIndex(photo => photo.id === photoId);
            if (index !== -1) {
                currentPhotoIndex = index;
                showScreen('homeScreen');
                updateDisplay();
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function exportAllData() {
            const exportData = {
                appData: appData,
                photos: userPhotos,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'flashback-export.json';
            link.click();
            
            alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function clearData() {
            if (confirm('‚ùå –û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('flashbackApp');
                localStorage.removeItem('flashbackPhotos');
                alert('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.');
                location.reload();
            }
        }
        
        // –°–±—Ä–æ—Å –æ–±—É—á–µ–Ω–∏—è
        function resetTutorial() {
            appData.tutorialCompleted = false;
            appData.tutorialShown = false;
            appData.viewed = 0;
            const subtitle = document.getElementById('photoSubtitle');
            subtitle.classList.remove('hidden');
            saveData();
            startTutorialTimer();
            alert('‚úÖ –û–±—É—á–µ–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ!');
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('beforeunload', saveData);
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (setupDragAndDrop, setupSmoothMenu, setupGestures –∏ —Ç.–¥.)
        // –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
        // ... (–≤—Å—Ç–∞–≤—å —Å—é–¥–∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞)
    </script>
</body>
</html>
